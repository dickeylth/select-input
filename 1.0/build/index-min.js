/*!build time : 2013-12-03 12:02:05 PM*/
KISSY.add("gallery/select-input/1.0/index",function(a,b,c,d){function e(a){var b=this;e.superclass.constructor.call(b,a);var c=f(b.get("container"));b.container=c,b._initHTML=c.html(),b._totalTpl=c.one(b.get("itemSelector")).outerHTML(),b.bindEvent()}var f=b.all;return a.extend(e,c,{bindEvent:function(){var a=this,b=a.container,c=a.get("buttons");d.delegate(b,"change","select",a.selectType,a),d.delegate(b,"click",c.add,a.addItem,a),d.delegate(b,"click",c.del,a.delItem,a),d.delegate(b,"keyup change","input",a.inputChange,a)},selectType:function(a){var b=this,c=f(a.currentTarget),d=c.getDOMNode().selectedIndex-1,e=b.get("itemSelector"),g=b.get("contentContainer"),h=b.get("inputContainer"),i=b.get("inpTpl")[d];g=c.parent(e).one(g),g.one(h).html(i),g.removeClass("hidden"),c.prop("disabled",!0),b.fire("select",{container:g,selectNode:c}),g.one("input").fire("focus")},addItem:function(a){var b=this,c=f(a.currentTarget),d=b.get("itemSelector"),e=(b.get("contentContainer"),b.get("inputContainer"),b._totalTpl),g=b.container.last(d);g.after(e),b.set("itemCount",b.get("itemCount")+1),c.addClass("hidden"),b.fire("add-item")},delItem:function(a){var b=this,c=f(a.currentTarget),d=b.get("itemSelector"),e=b.container.one(b.get("buttons").add);1==b.get("itemCount")?b.container.html(b._initHTML):(c.parent(d).remove(),e.removeClass("hidden"),b.set("itemCount",b.get("itemCount")-1)),b.fire("del-item")},inputChange:function(b){var c=this,d=f(b.currentTarget),e=c.get("contentContainer"),g=c.get("inputContainer"),h="",i=d.parent(e).one(c.get("buttons").del),j=c.container.one(c.get("buttons").add);d.parent(g).all("input").each(function(b){h+=a.trim(b.val())}),""!=h?(i.removeClass("hidden"),j.removeClass("hidden")):j.addClass("hidden")},getValue:function(){var b=this,c=b.get("itemSelector"),d=b.get("inputContainer"),e={};return b.container.all(c).each(function(c){var f=c.one("select").val(),g="",h=b.get("separator"),i=c.one(d).all("input");if(i.length>1){var j=[];i.each(function(b){var c=a.trim(b.val());""!=c&&j.push(c)}),g=j.join(h)}else g=a.trim(i.val());""!=g&&(f in e||(e[f]=[]),e[f].push(g))}),e}},{ATTRS:{container:{value:null,getter:function(a){return console.assert(a,"SelectInput container invalid!"),f(a)}},contentContainer:{value:null},inputContainer:{value:null},inpTpl:{value:[]},itemSelector:{value:null},buttons:{value:{add:null,del:null}},itemCount:{value:1},separator:{value:"#"}}}),e},{requires:["node","base","event"]});